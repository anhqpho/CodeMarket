<link rel="import" href="bower_components/note-app/common/note-app/na-elements.html">
<link rel="import" href="bower_components/note-app/common/note-app/na-toolbar.html">
<link rel="import" href="bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="bower_components/polymerfire/polymerfire.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="marketplace.html">

<dom-module id="code-market">
  <template>
      <style>
        #skill-set{
          padding-top: 10px;
        }
      </style>

      <!-- Leaving here for now until sign out button is implemented. Sign-in breaks when I remove the NA stuff. -->
      <na-toolbar
        id="toolbar"
        signed-in="[[signedIn]]"
        on-sign-out="signOut"
        tab-selected ="{{tabSelected}}">
      </na-toolbar>

      <na-login
        on-sign-in="signIn"
        signed-in="[[signedIn]]"
        disabled="[[!online]]">
      </na-login>

      <firebase-auth
        id="auth"
        app-name="CodeMarket"
        provider="google"
        signed-in="{{signedIn}}"
        user="{{user}}">
      </firebase-auth>

      <iron-pages id="content" selected="{{tabSelected}}">
        <div>
          <bidding-platform user="{{user}}"> </bidding-platform>
        </div>
        <div>Page 2</div>
        <div>Page 3</div>
        <div>
          <paper-input id="name"
            label="Name">
          </paper-input>

          <paper-input id="address"
            label="Address">
          </paper-input>

          <paper-input id="number"
            label="Phone number">
          </paper-input>

          <paper-input id="intro"
            label="Brief Introduction">
          </paper-input>

          <paper-toggle-button id="developer"
            checked="{{devMode}}">
            I am a developer
          </paper-toggle-button>

          <div id = "skill-set" hidden$="[[!devMode]]">
            <table border="2" hidden$="[[!devMode]]" class = "skill-set">
              <tbody>
                <tr>
                  <td><paper-checkbox>iOS App Dev</paper-checkbox></td>
                  <td><paper-checkbox>Swift</paper-checkbox></td>
                  <td><paper-checkbox>SQL</paper-checkbox></td>
                  <td><paper-checkbox>Web App</paper-checkbox></td>
                </tr>
                <tr>
                  <td><paper-checkbox>Java</paper-checkbox></td>
                  <td><paper-checkbox>JavaScript</paper-checkbox></td>
                  <td><paper-checkbox>Python</paper-checkbox></td>
                  <td><paper-checkbox>Android App Dev</paper-checkbox></td>
                </tr>
              </tbody>
            </table>
          </div>

          <paper-button raised on-click="submit"> SUBMIT </paper-button>
          <paper-button raised on-click="refresh"> REFRESH </paper-button>
        </div>
      </iron-pages>

  </template>
        <body onload="refresh">
  <script>
    Polymer({
      is: 'code-market',
      behaviors: [Polymer.NoteAppBehavior],

      signIn: function() {
        this.$.auth.signInWithPopup();
        this.$.content.select(3);
      },

      refresh: function() {
        //test code for retrieving database
        var getName;
        var getAddress;
        var getPhone;
        var getIntro;

        // Name
        var ref = firebase.database().ref('users/' + this.user.uid + '/name');
        ref.on("value", function(snapshot) {
           console.log(snapshot.val());
           getName = snapshot.val();
        }, function (error) {
           console.log("Error: " + error.code);
        });
        this.$.name.updateValueAndPreserveCaret(getName);

        // Address
        ref = firebase.database().ref('users/' + this.user.uid + '/address');
        ref.on("value", function(snapshot) {
           // console.log(snapshot.val());
           getAddress = snapshot.val();
        }, function (error) {
           console.log("Error: " + error.code);
        });
        this.$.address.updateValueAndPreserveCaret(getAddress);

        // Phone
        ref = firebase.database().ref('users/' + this.user.uid + '/number');
        ref.on("value", function(snapshot) {
           // console.log(snapshot.val());
           getPhone = snapshot.val();
        }, function (error) {
           console.log("Error: " + error.code);
        });
        this.$.number.updateValueAndPreserveCaret(getPhone);

        // Intro
        ref = firebase.database().ref('users/' + this.user.uid + '/intro');
        ref.on("value", function(snapshot) {
           // console.log(snapshot.val());
           getIntro = snapshot.val();
        }, function (error) {
           console.log("Error: " + error.code);
        });
        this.$.intro.updateValueAndPreserveCaret(getIntro);
      },

      // Submit button for profile.
      submit: function() {
        // Get a reference to the database service
        var database = firebase.database();
        var name = this.$.name.value;
        var address = this.$.address.value;
        var number = this.$.number.value;
        var intro = this.$.intro.value;
        var developer;
        if (!this.$.developer.checked) {
          developer = false;
          } else {
          developer = true;
          }

        // Using name here will probably create issues if people have the same name. Will worry about it later. Need to figure out how to get userID later on.
        //Also need someone to add developer and the skills
        firebase.database().ref('users/' + this.user.uid).set({
          name: name,
          address: address,
          number: number,
          intro: intro,
          developer: developer
        });
      },
    });

  </script>
  <script src="https://www.gstatic.com/firebasejs/3.6.0/firebase.js"></script>
  <script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCY1eIiLYwrLDikomyCasoBjSeaAn5SJoU",
    authDomain: "codemarket-45ea5.firebaseapp.com",
    databaseURL: "https://codemarket-45ea5.firebaseio.com",
    storageBucket: "codemarket-45ea5.appspot.com",
    messagingSenderId: "314239511119"
  };
  firebase.initializeApp(config);
  </script>

</dom-module>
